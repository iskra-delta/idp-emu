<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2"><title>WFG.htm</title></head><body><pre>; Partner WF/G ROM disassembly (delo v izdelavi)
; Matej Horvat

; ----------------------------------------

<a href="#0" name="0">0000</a>	SEEK	$0
<a href="#0" name="0">0000</a>	ORG	$0

; ----------------------------------------

<a href="#0" name="0">0000</a>	JP	<a href="#Zacetek">Zacetek</a>

; ----------------------------------------

; Ukazna vrstica, kjer uporabnik lahko izbere zagon z diskete
; ali s trdega diska.

;;<a href="#UkaznaVrstica" name="UkaznaVrstica">UkaznaVrstica</a>:
<a href="#3" name="3">0003</a>	LD	SP,#FFC0
<a href="#6" name="6">0006</a>	CALL	<a href="#PrelomVrstice">PrelomVrstice</a>
<a href="#9" name="9">0009</a>	LD	A,#2A	; '*'
<a href="#B" name="B">000B</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>
<a href="#E" name="E">000E</a>	CALL	<a href="#BeriInIzpisiZnak">BeriInIzpisiZnak</a>
<a href="#11" name="11">0011</a>	AND	#DF	; Pretvori v uppercase
<a href="#13" name="13">0013</a>	CP	#41	; 'A'
<a href="#15" name="15">0015</a>	JP	Z,<a href="#HDBootSkok">HDBootSkok</a>
<a href="#18" name="18">0018</a>	CP	#46	; 'F'
<a href="#1A" name="1A">001A</a>	JP	Z,<a href="#FDBootSkok">FDBootSkok</a>
;;<a href="#NeznanUkaz" name="NeznanUkaz">NeznanUkaz</a>:
<a href="#1D" name="1D">001D</a>	LD	A,#3F	; '?'
<a href="#1F" name="1F">001F</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>
<a href="#22" name="22">0022</a>	JR	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

; Nerabljeni nicxelni bajti oz. NOP-i.

<a href="#24" name="24">0024</a>	DS	66, $00

; ----------------------------------------

; Nerabljen skok.

<a href="#66" name="66">0066</a>	JP	<a href="#NeznanUkaz">NeznanUkaz</a>

; ----------------------------------------

; Nerabljene procedure za izpis sxestnajstisxkih sxtevil.

;;<a href="#IzpisiHex16" name="IzpisiHex16">IzpisiHex16</a>:
<a href="#69" name="69">0069</a>	CALL	<a href="#PrelomVrstice">PrelomVrstice</a>
<a href="#6C" name="6C">006C</a>	LD	A,H
<a href="#6D" name="6D">006D</a>	CALL	<a href="#IzpisiHex8">IzpisiHex8</a>
<a href="#70" name="70">0070</a>	LD	A,L
<a href="#71" name="71">0071</a>	CALL	<a href="#IzpisiHex8">IzpisiHex8</a>
<a href="#74" name="74">0074</a>	LD	A,#20	; ' '
<a href="#76" name="76">0076</a>	JP	<a href="#GDPUkaz">GDPUkaz</a>
;;<a href="#IzpisiHex8" name="IzpisiHex8">IzpisiHex8</a>:
<a href="#79" name="79">0079</a>	PUSH	BC
<a href="#7A" name="7A">007A</a>	LD	B,A
<a href="#7B" name="7B">007B</a>	SRA	A
<a href="#7D" name="7D">007D</a>	SRA	A
<a href="#7F" name="7F">007F</a>	SRA	A
<a href="#81" name="81">0081</a>	SRA	A
<a href="#83" name="83">0083</a>	AND	#0F
<a href="#85" name="85">0085</a>	CALL	<a href="#IzpisiHex4">IzpisiHex4</a>
<a href="#88" name="88">0088</a>	LD	A,B
<a href="#89" name="89">0089</a>	AND	#0F
<a href="#8B" name="8B">008B</a>	CALL	<a href="#IzpisiHex4">IzpisiHex4</a>
<a href="#8E" name="8E">008E</a>	POP	BC
<a href="#8F" name="8F">008F</a>	RET
;;<a href="#IzpisiHex4" name="IzpisiHex4">IzpisiHex4</a>:
<a href="#90" name="90">0090</a>	CP	#0A
<a href="#92" name="92">0092</a>	JP	M,<a href="#99">#0099</a>
<a href="#95" name="95">0095</a>	ADD	A,#37
<a href="#97" name="97">0097</a>	JR	<a href="#9B">#009B</a>
<a href="#99" name="99">0099</a>	ADD	A,#30
<a href="#9B" name="9B">009B</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>
<a href="#9E" name="9E">009E</a>	RET

; ----------------------------------------

; Pocxaka, da uporabnik pritisne tipko na tipkovnici,
; nato izpisxe njen znak na GDP.

;;<a href="#BeriInIzpisiZnak" name="BeriInIzpisiZnak">BeriInIzpisiZnak</a>:
<a href="#9F" name="9F">009F</a>	IN	A,(#D9)
<a href="#A1" name="A1">00A1</a>	BIT	0,A
<a href="#A3" name="A3">00A3</a>	JR	Z,<a href="#BeriInIzpisiZnak">BeriInIzpisiZnak</a>	; Cxakaj, da je znak na voljo.
<a href="#A5" name="A5">00A5</a>	IN	A,(#D8)
<a href="#A7" name="A7">00A7</a>	RES	7,A
<a href="#A9" name="A9">00A9</a>	CP	#20
<a href="#AB" name="AB">00AB</a>	RET	C	; Cxe je kontrolni znak, koncxamo.

; ----------------------------------------

; Posxlje ukaz na GDP.

;;<a href="#GDPUkaz" name="GDPUkaz">GDPUkaz</a>:
<a href="#AC" name="AC">00AC</a>	CALL	<a href="#CakajGDP">CakajGDP</a>
<a href="#AF" name="AF">00AF</a>	OUT	(#20),A
<a href="#B1" name="B1">00B1</a>	RET

; ----------------------------------------

; Pocxaka, da GDP koncxa izvajanje morebitnega ukaza.

;;<a href="#CakajGDP" name="CakajGDP">CakajGDP</a>:
<a href="#B2" name="B2">00B2</a>	PUSH	AF
<a href="#B3" name="B3">00B3</a>	IN	A,(#20)
<a href="#B5" name="B5">00B5</a>	AND	#04
<a href="#B7" name="B7">00B7</a>	JR	Z,<a href="#B3">#00B3</a>
<a href="#B9" name="B9">00B9</a>	POP	AF
<a href="#BA" name="BA">00BA</a>	RET

; ----------------------------------------

; Nerabljena procedura, ki izpisxe presledek na GDP.

;;<a href="#IzpisiPresledek" name="IzpisiPresledek">IzpisiPresledek</a>:
<a href="#BB" name="BB">00BB</a>	LD	A,#20
<a href="#BD" name="BD">00BD</a>	JR	<a href="#GDPUkaz">GDPUkaz</a>

; ----------------------------------------

; Izvede prelom vrstice.

; Pomaknemo vsebino zaslona 12 pikslov navzgor.
;;<a href="#PrelomVrstice" name="PrelomVrstice">PrelomVrstice</a>:
<a href="#BF" name="BF">00BF</a>	CALL	<a href="#CakajGDP">CakajGDP</a>
<a href="#C2" name="C2">00C2</a>	LD	A,(<a href="#Scroll">Scroll</a>)
<a href="#C5" name="C5">00C5</a>	SUB	#0C
<a href="#C7" name="C7">00C7</a>	LD	(<a href="#Scroll">Scroll</a>),A
<a href="#CA" name="CA">00CA</a>	OUT	(#36),A
<a href="#CC" name="CC">00CC</a>	PUSH	HL
; Izbrisxemo novo vrstico.
<a href="#CD" name="CD">00CD</a>	LD	HL,#00DE
<a href="#D0" name="D0">00D0</a>	CALL	<a href="#IzpisiNiz">IzpisiNiz</a>
; Premaknemo pero na levo.
<a href="#D3" name="D3">00D3</a>	LD	HL,#00F3
<a href="#D6" name="D6">00D6</a>	CALL	<a href="#IzpisiNiz">IzpisiNiz</a>
<a href="#D9" name="D9">00D9</a>	POP	HL
; Izberemo nacxin risanja.
<a href="#DA" name="DA">00DA</a>	XOR	A
<a href="#DB" name="DB">00DB</a>	JP	<a href="#GDPUkaz">GDPUkaz</a>

; ----------------------------------------

; Niz ukazov za GDP, ki premakne pero v spodnji levi kot in pobrisxe vrstico.

<a href="#DE" name="DE">00DE</a>	DB	$03, $00, $05, $01, $0B, $0B, $0B, $0B
<a href="#E6" name="E6">00E6</a>	DB	$0B, $0B, $0B, $0B, $0B, $0B, $0B, $0B
<a href="#EE" name="EE">00EE</a>	DB	$0B, $0B, $0B, $0B, $00

; ----------------------------------------

; Niz ukazov za GDP, ki premakne pero na skrajno levo.

<a href="#F3" name="F3">00F3</a>	DB	$21, $00, $0D, $00

; ----------------------------------------

; Vstopna tocxka v memory test.

;;<a href="#MemoryTest" name="MemoryTest">MemoryTest</a>:
<a href="#F7" name="F7">00F7</a>	LD	HL,#02D1
<a href="#FA" name="FA">00FA</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>
<a href="#FD" name="FD">00FD</a>	LD	HL,#2000
<a href="#100" name="100">0100</a>	LD	BC,#FF80
<a href="#103" name="103">0103</a>	LD	D,#02
<a href="#105" name="105">0105</a>	LD	A,#00
<a href="#107" name="107">0107</a>	PUSH	DE
<a href="#108" name="108">0108</a>	PUSH	AF
<a href="#109" name="109">0109</a>	CALL	<a href="#114">#0114</a>
<a href="#10C" name="10C">010C</a>	POP	AF
<a href="#10D" name="10D">010D</a>	POP	DE
<a href="#10E" name="10E">010E</a>	ADD	A,#55
<a href="#110" name="110">0110</a>	DEC	D
<a href="#111" name="111">0111</a>	JR	NZ,<a href="#107">#0107</a>
<a href="#113" name="113">0113</a>	RET

; ----------------------------------------

<a href="#114" name="114">0114</a>	CALL	<a href="#125">#0125</a>
<a href="#117" name="117">0117</a>	OUT	(#90),A
<a href="#119" name="119">0119</a>	CALL	<a href="#125">#0125</a>
<a href="#11C" name="11C">011C</a>	CALL	<a href="#138">#0138</a>
<a href="#11F" name="11F">011F</a>	OUT	(#88),A
<a href="#121" name="121">0121</a>	CALL	<a href="#138">#0138</a>
<a href="#124" name="124">0124</a>	RET

; ----------------------------------------

<a href="#125" name="125">0125</a>	PUSH	AF
<a href="#126" name="126">0126</a>	PUSH	HL
<a href="#127" name="127">0127</a>	LD	D,A
<a href="#128" name="128">0128</a>	CPL
<a href="#129" name="129">0129</a>	LD	E,A
<a href="#12A" name="12A">012A</a>	LD	(HL),D
<a href="#12B" name="12B">012B</a>	INC	HL
<a href="#12C" name="12C">012C</a>	LD	(HL),E
<a href="#12D" name="12D">012D</a>	INC	HL
<a href="#12E" name="12E">012E</a>	PUSH	HL
<a href="#12F" name="12F">012F</a>	OR	A
<a href="#130" name="130">0130</a>	SBC	HL,BC
<a href="#132" name="132">0132</a>	POP	HL
<a href="#133" name="133">0133</a>	JR	C,<a href="#12A">#012A</a>
<a href="#135" name="135">0135</a>	POP	HL
<a href="#136" name="136">0136</a>	POP	AF
<a href="#137" name="137">0137</a>	RET

; ----------------------------------------

<a href="#138" name="138">0138</a>	PUSH	HL
<a href="#139" name="139">0139</a>	PUSH	AF
<a href="#13A" name="13A">013A</a>	LD	D,A
<a href="#13B" name="13B">013B</a>	CPL
<a href="#13C" name="13C">013C</a>	LD	E,A
<a href="#13D" name="13D">013D</a>	LD	A,(HL)
<a href="#13E" name="13E">013E</a>	CP	D
<a href="#13F" name="13F">013F</a>	JR	NZ,<a href="#151">#0151</a>
<a href="#141" name="141">0141</a>	INC	HL
<a href="#142" name="142">0142</a>	LD	A,(HL)
<a href="#143" name="143">0143</a>	CP	E
<a href="#144" name="144">0144</a>	JR	NZ,<a href="#151">#0151</a>
<a href="#146" name="146">0146</a>	INC	HL
<a href="#147" name="147">0147</a>	PUSH	HL
<a href="#148" name="148">0148</a>	OR	A
<a href="#149" name="149">0149</a>	SBC	HL,BC
<a href="#14B" name="14B">014B</a>	POP	HL
<a href="#14C" name="14C">014C</a>	JR	C,<a href="#13D">#013D</a>
<a href="#14E" name="14E">014E</a>	POP	AF
<a href="#14F" name="14F">014F</a>	POP	HL
<a href="#150" name="150">0150</a>	RET
<a href="#151" name="151">0151</a>	LD	HL,#015A
<a href="#154" name="154">0154</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>
<a href="#157" name="157">0157</a>	JP	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

; Sporocxilo o neuspelem memory testu.

<a href="#15A" name="15A">015A</a>	DB	$21, $00
<a href="#15C" name="15C">015C</a>	DZ	"MEMORY ERROR !!!"

; ----------------------------------------

;;<a href="#Zacetek" name="Zacetek">Zacetek</a>:
<a href="#16D" name="16D">016D</a>	LD	SP,#FFC0

; Inicializacija PIO
<a href="#170" name="170">0170</a>	LD	A,#07
<a href="#172" name="172">0172</a>	OUT	(#31),A
<a href="#174" name="174">0174</a>	OUT	(#33),A
<a href="#176" name="176">0176</a>	LD	A,#0F
<a href="#178" name="178">0178</a>	OUT	(#31),A
<a href="#17A" name="17A">017A</a>	OUT	(#33),A

<a href="#17C" name="17C">017C</a>	LD	A,#18
<a href="#17E" name="17E">017E</a>	OUT	(#30),A
<a href="#180" name="180">0180</a>	LD	A,#6D
<a href="#182" name="182">0182</a>	OUT	(#32),A
<a href="#184" name="184">0184</a>	XOR	A
<a href="#185" name="185">0185</a>	OUT	(#39),A
<a href="#187" name="187">0187</a>	OUT	(#36),A
<a href="#189" name="189">0189</a>	LD	(<a href="#Scroll">Scroll</a>),A

; (odvecx)
<a href="#18C" name="18C">018C</a>	XOR	A
<a href="#18D" name="18D">018D</a>	OUT	(#21),A

; Izbira in spust GDP peresa
<a href="#18F" name="18F">018F</a>	LD	A,#03
<a href="#191" name="191">0191</a>	OUT	(#21),A

<a href="#193" name="193">0193</a>	LD	A,#04	; Pocxistimo GDP sliko...
<a href="#195" name="195">0195</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>
<a href="#198" name="198">0198</a>	LD	A,#05	; ... in postavimo pero na levi rob.
<a href="#19A" name="19A">019A</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>

<a href="#19D" name="19D">019D</a>	XOR	A
<a href="#19E" name="19E">019E</a>	OUT	(#39),A
<a href="#1A0" name="1A0">01A0</a>	OUT	(#30),A

<a href="#1A2" name="1A2">01A2</a>	CALL	<a href="#AVDCInit1">AVDCInit1</a>
<a href="#1A5" name="1A5">01A5</a>	CALL	<a href="#AVDCInit2">AVDCInit2</a>

; Inicializacija SIO "CRT" kanala (za tipkovnico)
<a href="#1A8" name="1A8">01A8</a>	LD	C,#D9
<a href="#1AA" name="1AA">01AA</a>	LD	HL,#02B6
<a href="#1AD" name="1AD">01AD</a>	LD	B,#07
<a href="#1AF" name="1AF">01AF</a>	OTIR

; Inicializacija SIO "LPT" kanala
<a href="#1B1" name="1B1">01B1</a>	LD	C,#DB
<a href="#1B3" name="1B3">01B3</a>	LD	HL,#02B6
<a href="#1B6" name="1B6">01B6</a>	LD	B,#07
<a href="#1B8" name="1B8">01B8</a>	OTIR

; Inicializacija SIO "VAX" kanala
<a href="#1BA" name="1BA">01BA</a>	LD	C,#E1
<a href="#1BC" name="1BC">01BC</a>	LD	HL,#02B6
<a href="#1BF" name="1BF">01BF</a>	LD	B,#07
<a href="#1C1" name="1C1">01C1</a>	OTIR

<a href="#1C3" name="1C3">01C3</a>	LD	SP,#FFC0

; Y koordinata GDP peresa := 100
<a href="#1C6" name="1C6">01C6</a>	LD	A,#64
<a href="#1C8" name="1C8">01C8</a>	OUT	(#2B),A

<a href="#1CA" name="1CA">01CA</a>	LD	HL,#02BD
<a href="#1CD" name="1CD">01CD</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>

; Spet postavimo pero na levi rob.
<a href="#1D0" name="1D0">01D0</a>	LD	A,#05
<a href="#1D2" name="1D2">01D2</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>

<a href="#1D5" name="1D5">01D5</a>	LD	HL,#022D
<a href="#1D8" name="1D8">01D8</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>

<a href="#1DB" name="1DB">01DB</a>	CALL	<a href="#MemoryTest">MemoryTest</a>

<a href="#1DE" name="1DE">01DE</a>	CALL	<a href="#FDCInit">FDCInit</a>

<a href="#1E1" name="1E1">01E1</a>	CALL	<a href="#2EE">#02EE</a>

<a href="#1E4" name="1E4">01E4</a>	IN	A,(#D9)
<a href="#1E6" name="1E6">01E6</a>	AND	#01	; Je na voljo znak na tipkovnici?
<a href="#1E8" name="1E8">01E8</a>	JP	Z,<a href="#HDBootSkok">HDBootSkok</a>
<a href="#1EB" name="1EB">01EB</a>	CALL	<a href="#BeriInIzpisiZnak">BeriInIzpisiZnak</a>
<a href="#1EE" name="1EE">01EE</a>	CP	#03	; Je CTL+C?
<a href="#1F0" name="1F0">01F0</a>	JP	NZ,<a href="#HDBootSkok">HDBootSkok</a>
<a href="#1F3" name="1F3">01F3</a>	LD	HL,#01FC
<a href="#1F6" name="1F6">01F6</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>
<a href="#1F9" name="1F9">01F9</a>	JP	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

; Sporocxilo o prekinjenem zagonu.

<a href="#1FC" name="1FC">01FC</a>	DB	$21, $00
<a href="#1FE" name="1FE">01FE</a>	DZ	"Interrupted, press A or F to load the system !"

; ----------------------------------------

; Niz z verzijo programa.

<a href="#22D" name="22D">022D</a>	DB	$21, $00
<a href="#22F" name="22F">022F</a>	DZ	"[ Boot V 1.1 - WF ]"

; ----------------------------------------

;;<a href="#IzpisiPrelomInNiz" name="IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>:
<a href="#243" name="243">0243</a>	CALL	<a href="#PrelomVrstice">PrelomVrstice</a>
; (se nadaljuje v IzpisiNiz)

; ----------------------------------------

; Izpisxe niz na GDP.
; Prvi bajt niza se zapisxe v GDP-jev register za velikost znakov,
; drugi pa v kontrolni register 2. V praksi je drugi bajt vedno 0,
; lahko bi pa bil 4 za lezxecxe besedilo.

; Vhod:
; HL -&gt; niz, zakljucxen z 0

; Unicxi A.

;;<a href="#IzpisiNiz" name="IzpisiNiz">IzpisiNiz</a>:
<a href="#246" name="246">0246</a>	CALL	<a href="#CakajGDP">CakajGDP</a>
<a href="#249" name="249">0249</a>	LD	A,(HL)
<a href="#24A" name="24A">024A</a>	OUT	(#23),A
<a href="#24C" name="24C">024C</a>	INC	HL
<a href="#24D" name="24D">024D</a>	LD	A,(HL)
<a href="#24E" name="24E">024E</a>	OUT	(#22),A
<a href="#250" name="250">0250</a>	INC	HL
<a href="#251" name="251">0251</a>	LD	A,(HL)
<a href="#252" name="252">0252</a>	OR	A
<a href="#253" name="253">0253</a>	RET	Z
<a href="#254" name="254">0254</a>	CALL	<a href="#GDPUkaz">GDPUkaz</a>
<a href="#257" name="257">0257</a>	INC	HL
<a href="#258" name="258">0258</a>	JR	<a href="#251">#0251</a>

; ----------------------------------------

;;<a href="#Zakasnitev" name="Zakasnitev">Zakasnitev</a>:
<a href="#25A" name="25A">025A</a>	PUSH	BC
<a href="#25B" name="25B">025B</a>	LD	B,#FF
<a href="#25D" name="25D">025D</a>	NOP
<a href="#25E" name="25E">025E</a>	DJNZ	<a href="#25D">#025D</a>
<a href="#260" name="260">0260</a>	POP	BC
<a href="#261" name="261">0261</a>	RET

; ----------------------------------------

;;<a href="#AVDCInit1" name="AVDCInit1">AVDCInit1</a>:
<a href="#262" name="262">0262</a>	LD	A,#00
<a href="#264" name="264">0264</a>	OUT	(#39),A
<a href="#266" name="266">0266</a>	CALL	<a href="#Zakasnitev">Zakasnitev</a>
<a href="#269" name="269">0269</a>	CALL	<a href="#Zakasnitev">Zakasnitev</a>
<a href="#26C" name="26C">026C</a>	CALL	<a href="#Zakasnitev">Zakasnitev</a>
<a href="#26F" name="26F">026F</a>	LD	HL,#02AC
<a href="#272" name="272">0272</a>	XOR	A

; SS1 := 0
<a href="#273" name="273">0273</a>	OUT	(#3E),A
<a href="#275" name="275">0275</a>	OUT	(#3F),A

; SS2 := 0
<a href="#277" name="277">0277</a>	OUT	(#3A),A
<a href="#279" name="279">0279</a>	OUT	(#3B),A

<a href="#27B" name="27B">027B</a>	LD	A,#10
<a href="#27D" name="27D">027D</a>	OUT	(#39),A
<a href="#27F" name="27F">027F</a>	LD	B,#0A
<a href="#281" name="281">0281</a>	LD	C,#38
<a href="#283" name="283">0283</a>	OTIR

<a href="#285" name="285">0285</a>	RET

; ----------------------------------------

; Vkljucxi AVDC kurzor in ???
;;<a href="#AVDCInit2" name="AVDCInit2">AVDCInit2</a>:
<a href="#286" name="286">0286</a>	LD	A,#3D
<a href="#288" name="288">0288</a>	OUT	(#39),A

; Naslov AVDC kurzorja := 0
<a href="#28A" name="28A">028A</a>	XOR	A
<a href="#28B" name="28B">028B</a>	OUT	(#3D),A
<a href="#28D" name="28D">028D</a>	OUT	(#3C),A

<a href="#28F" name="28F">028F</a>	LD	HL,#1FFF
<a href="#292" name="292">0292</a>	CALL	<a href="#AVDCNastaviDispAddr">AVDCNastaviDispAddr</a>

; Zapolni AVDC framebuffer s presledki?
<a href="#295" name="295">0295</a>	LD	A,#20
<a href="#297" name="297">0297</a>	OUT	(#34),A
<a href="#299" name="299">0299</a>	XOR	A
<a href="#29A" name="29A">029A</a>	OUT	(#35),A
<a href="#29C" name="29C">029C</a>	LD	A,#BB	; Write from cursor to pointer
<a href="#29E" name="29E">029E</a>	OUT	(#39),A

<a href="#2A0" name="2A0">02A0</a>	RET

; ----------------------------------------

; Nastavi AVDC inicializacijska registra 10 in 11
; (display address register lower/upper).

; Vhod:
; HL = novi display address

; Unicxi A.

;;<a href="#AVDCNastaviDispAddr" name="AVDCNastaviDispAddr">AVDCNastaviDispAddr</a>:
<a href="#2A1" name="2A1">02A1</a>	LD	A,#1A
<a href="#2A3" name="2A3">02A3</a>	OUT	(#39),A
<a href="#2A5" name="2A5">02A5</a>	LD	A,L
<a href="#2A6" name="2A6">02A6</a>	OUT	(#38),A
<a href="#2A8" name="2A8">02A8</a>	LD	A,H
<a href="#2A9" name="2A9">02A9</a>	OUT	(#38),A
<a href="#2AB" name="2AB">02AB</a>	RET

; ----------------------------------------

; Inicializacijski niz za AVDC.

<a href="#2AC" name="2AC">02AC</a>	DB	$D0, $2F, $0D, $05, $99, $4F, $0A, $EA
<a href="#2B4" name="2B4">02B4</a>	DB	$00, $30

; ----------------------------------------

; Inicializacijski niz za serijska vrata.

<a href="#2B6" name="2B6">02B6</a>	DB	$18, $04, $44, $03, $C1, $05, $68

; ----------------------------------------

; Zagonsko sporocxilo.

<a href="#2BD" name="2BD">02BD</a>	DB	$A8, $00
<a href="#2BF" name="2BF">02BF</a>	DZ	"Delta Partner GDP"

; ----------------------------------------

; Sporocxilo o testiranju spomina.

<a href="#2D1" name="2D1">02D1</a>	DB	$21, $00
<a href="#2D3" name="2D3">02D3</a>	DZ	"TESTING MEMORY ... "

; ----------------------------------------

; Nerabljen bajt?

<a href="#2E7" name="2E7">02E7</a>	DB	$00

; ----------------------------------------

; ???
; To je v resnici IVT, ki kazxe tudi na FDC handler na 4CA

<a href="#2E8" name="2E8">02E8</a>	DW	<a href="#4CA">$04CA</a>, <a href="#5D6">$05D6</a>, <a href="#524">$0524</a>

; ----------------------------------------

; Prazna funkcija; verjetno se je pogojno uporabljala med razvojem.

<a href="#2EE" name="2EE">02EE</a>	RET

; ----------------------------------------

; Nerabljeno.

<a href="#2EF" name="2EF">02EF</a>	NOP
<a href="#2F0" name="2F0">02F0</a>	NOP

; ----------------------------------------

; Nerabljen skok.

<a href="#2F1" name="2F1">02F1</a>	JP	<a href="#4CE">#04CE</a>

; ----------------------------------------

;;<a href="#HDBootSkok" name="HDBootSkok">HDBootSkok</a>:
<a href="#2F4" name="2F4">02F4</a>	JP	<a href="#HDBoot">HDBoot</a>

; ----------------------------------------

; Nerabljen skok.

<a href="#2F7" name="2F7">02F7</a>	JP	<a href="#5A7">#05A7</a>

; ----------------------------------------

;;<a href="#FDBootSkok" name="FDBootSkok">FDBootSkok</a>:
<a href="#2FA" name="2FA">02FA</a>	JP	<a href="#FDBoot">FDBoot</a>

; ----------------------------------------

;;<a href="#FDCInit" name="FDCInit">FDCInit</a>:
<a href="#2FD" name="2FD">02FD</a>	DI
<a href="#2FE" name="2FE">02FE</a>	IM	2
<a href="#300" name="300">0300</a>	LD	HL,#02E8
<a href="#303" name="303">0303</a>	LD	A,L
<a href="#304" name="304">0304</a>	OUT	(#E8),A
<a href="#306" name="306">0306</a>	OUT	(#C8),A
<a href="#308" name="308">0308</a>	LD	A,H
<a href="#309" name="309">0309</a>	LD	I,A
<a href="#30B" name="30B">030B</a>	EI
<a href="#30C" name="30C">030C</a>	HALT
<a href="#30D" name="30D">030D</a>	LD	A,#08
<a href="#30F" name="30F">030F</a>	CALL	<a href="#337">#0337</a>
<a href="#312" name="312">0312</a>	CALL	<a href="#345">#0345</a>
<a href="#315" name="315">0315</a>	CALL	<a href="#345">#0345</a>
<a href="#318" name="318">0318</a>	LD	A,#03
<a href="#31A" name="31A">031A</a>	CALL	<a href="#337">#0337</a>
<a href="#31D" name="31D">031D</a>	LD	A,#0D
<a href="#31F" name="31F">031F</a>	AND	#0F
<a href="#321" name="321">0321</a>	RLCA
<a href="#322" name="322">0322</a>	RLCA
<a href="#323" name="323">0323</a>	RLCA
<a href="#324" name="324">0324</a>	RLCA
<a href="#325" name="325">0325</a>	LD	B,A
<a href="#326" name="326">0326</a>	LD	A,#0E
<a href="#328" name="328">0328</a>	AND	#0F
<a href="#32A" name="32A">032A</a>	OR	B
<a href="#32B" name="32B">032B</a>	CALL	<a href="#337">#0337</a>
<a href="#32E" name="32E">032E</a>	LD	A,#04
<a href="#330" name="330">0330</a>	RLCA
<a href="#331" name="331">0331</a>	AND	#FE
<a href="#333" name="333">0333</a>	CALL	<a href="#337">#0337</a>
<a href="#336" name="336">0336</a>	RET

; ----------------------------------------

<a href="#337" name="337">0337</a>	PUSH	AF
<a href="#338" name="338">0338</a>	IN	A,(#F0)
<a href="#33A" name="33A">033A</a>	AND	#C0
<a href="#33C" name="33C">033C</a>	CP	#80
<a href="#33E" name="33E">033E</a>	JP	NZ,<a href="#338">#0338</a>
<a href="#341" name="341">0341</a>	POP	AF
<a href="#342" name="342">0342</a>	OUT	(#F1),A
<a href="#344" name="344">0344</a>	RET

; ----------------------------------------

<a href="#345" name="345">0345</a>	IN	A,(#F0)
<a href="#347" name="347">0347</a>	AND	#C0
<a href="#349" name="349">0349</a>	CP	#C0
<a href="#34B" name="34B">034B</a>	JP	NZ,<a href="#345">#0345</a>
<a href="#34E" name="34E">034E</a>	IN	A,(#F1)
<a href="#350" name="350">0350</a>	RET

; ----------------------------------------

<a href="#351" name="351">0351</a>	LD	A,#07
<a href="#353" name="353">0353</a>	CALL	<a href="#337">#0337</a>
<a href="#356" name="356">0356</a>	LD	A,(<a href="#Neznano1">Neznano1</a>)
<a href="#359" name="359">0359</a>	CALL	<a href="#337">#0337</a>
<a href="#35C" name="35C">035C</a>	EI
<a href="#35D" name="35D">035D</a>	HALT
<a href="#35E" name="35E">035E</a>	LD	A,#08
<a href="#360" name="360">0360</a>	CALL	<a href="#337">#0337</a>
<a href="#363" name="363">0363</a>	CALL	<a href="#345">#0345</a>
<a href="#366" name="366">0366</a>	CALL	<a href="#345">#0345</a>
<a href="#369" name="369">0369</a>	XOR	A
<a href="#36A" name="36A">036A</a>	LD	(<a href="#Neznano2">Neznano2</a>),A
<a href="#36D" name="36D">036D</a>	LD	(<a href="#Neznano6">Neznano6</a>),A
<a href="#370" name="370">0370</a>	RET

; ----------------------------------------

<a href="#371" name="371">0371</a>	CALL	<a href="#3ED">#03ED</a>
<a href="#374" name="374">0374</a>	RET	NZ
<a href="#375" name="375">0375</a>	LD	A,#0A
<a href="#377" name="377">0377</a>	LD	(<a href="#Neznano5">Neznano5</a>),A
<a href="#37A" name="37A">037A</a>	LD	A,#05
<a href="#37C" name="37C">037C</a>	OUT	(#C0),A
<a href="#37E" name="37E">037E</a>	LD	A,#CF
<a href="#380" name="380">0380</a>	OUT	(#C0),A
<a href="#382" name="382">0382</a>	CALL	<a href="#45C">#045C</a>
<a href="#385" name="385">0385</a>	LD	HL,#046E
<a href="#388" name="388">0388</a>	OTIR
<a href="#38A" name="38A">038A</a>	LD	A,#06
<a href="#38C" name="38C">038C</a>	OR	#40
<a href="#38E" name="38E">038E</a>	CALL	<a href="#42A">#042A</a>
<a href="#391" name="391">0391</a>	CALL	<a href="#446">#0446</a>
<a href="#394" name="394">0394</a>	EI
<a href="#395" name="395">0395</a>	HALT
<a href="#396" name="396">0396</a>	JP	C,<a href="#3AB">#03AB</a>
<a href="#399" name="399">0399</a>	IN	A,(#98)
<a href="#39B" name="39B">039B</a>	AND	#01
<a href="#39D" name="39D">039D</a>	JP	NZ,<a href="#394">#0394</a>
<a href="#3A0" name="3A0">03A0</a>	LD	HL,#0529
<a href="#3A3" name="3A3">03A3</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>
<a href="#3A6" name="3A6">03A6</a>	OUT	(#98),A
<a href="#3A8" name="3A8">03A8</a>	JP	<a href="#394">#0394</a>
<a href="#3AB" name="3AB">03AB</a>	LD	A,#03
<a href="#3AD" name="3AD">03AD</a>	OUT	(#CA),A
<a href="#3AF" name="3AF">03AF</a>	CALL	<a href="#345">#0345</a>
<a href="#3B2" name="3B2">03B2</a>	CALL	<a href="#345">#0345</a>
<a href="#3B5" name="3B5">03B5</a>	PUSH	AF
<a href="#3B6" name="3B6">03B6</a>	LD	B,#05
<a href="#3B8" name="3B8">03B8</a>	CALL	<a href="#345">#0345</a>
<a href="#3BB" name="3BB">03BB</a>	DEC	B
<a href="#3BC" name="3BC">03BC</a>	JP	NZ,<a href="#3B8">#03B8</a>
<a href="#3BF" name="3BF">03BF</a>	POP	AF
<a href="#3C0" name="3C0">03C0</a>	CP	#80
<a href="#3C2" name="3C2">03C2</a>	RET	Z
<a href="#3C3" name="3C3">03C3</a>	LD	A,(<a href="#Neznano5">Neznano5</a>)
<a href="#3C6" name="3C6">03C6</a>	OR	A
<a href="#3C7" name="3C7">03C7</a>	JP	Z,<a href="#3EB">#03EB</a>
<a href="#3CA" name="3CA">03CA</a>	DEC	A
<a href="#3CB" name="3CB">03CB</a>	LD	(<a href="#Neznano5">Neznano5</a>),A
<a href="#3CE" name="3CE">03CE</a>	LD	A,(<a href="#Neznano2">Neznano2</a>)
<a href="#3D1" name="3D1">03D1</a>	PUSH	AF
<a href="#3D2" name="3D2">03D2</a>	INC	A
<a href="#3D3" name="3D3">03D3</a>	LD	(<a href="#Neznano2">Neznano2</a>),A
<a href="#3D6" name="3D6">03D6</a>	LD	A,(<a href="#Neznano6">Neznano6</a>)
<a href="#3D9" name="3D9">03D9</a>	PUSH	AF
<a href="#3DA" name="3DA">03DA</a>	CALL	<a href="#3ED">#03ED</a>
<a href="#3DD" name="3DD">03DD</a>	POP	AF
<a href="#3DE" name="3DE">03DE</a>	LD	(<a href="#Neznano6">Neznano6</a>),A
<a href="#3E1" name="3E1">03E1</a>	POP	AF
<a href="#3E2" name="3E2">03E2</a>	LD	(<a href="#Neznano2">Neznano2</a>),A
<a href="#3E5" name="3E5">03E5</a>	CALL	<a href="#3ED">#03ED</a>
<a href="#3E8" name="3E8">03E8</a>	JP	<a href="#37A">#037A</a>
<a href="#3EB" name="3EB">03EB</a>	INC	A
<a href="#3EC" name="3EC">03EC</a>	RET

; ----------------------------------------

<a href="#3ED" name="3ED">03ED</a>	CALL	<a href="#501">#0501</a>
<a href="#3F0" name="3F0">03F0</a>	LD	A,#0F
<a href="#3F2" name="3F2">03F2</a>	CALL	<a href="#337">#0337</a>
<a href="#3F5" name="3F5">03F5</a>	CALL	<a href="#41B">#041B</a>
<a href="#3F8" name="3F8">03F8</a>	CALL	<a href="#337">#0337</a>
<a href="#3FB" name="3FB">03FB</a>	LD	A,(<a href="#Neznano2">Neznano2</a>)
<a href="#3FE" name="3FE">03FE</a>	CALL	<a href="#337">#0337</a>
<a href="#401" name="401">0401</a>	EI
<a href="#402" name="402">0402</a>	HALT
<a href="#403" name="403">0403</a>	LD	A,#08
<a href="#405" name="405">0405</a>	CALL	<a href="#337">#0337</a>
<a href="#408" name="408">0408</a>	CALL	<a href="#345">#0345</a>
<a href="#40B" name="40B">040B</a>	CALL	<a href="#345">#0345</a>
<a href="#40E" name="40E">040E</a>	LD	B,A
<a href="#40F" name="40F">040F</a>	LD	A,(<a href="#Neznano2">Neznano2</a>)
<a href="#412" name="412">0412</a>	CP	B
<a href="#413" name="413">0413</a>	JP	Z,<a href="#419">#0419</a>
<a href="#416" name="416">0416</a>	XOR	A
<a href="#417" name="417">0417</a>	INC	A
<a href="#418" name="418">0418</a>	RET
<a href="#419" name="419">0419</a>	XOR	A
<a href="#41A" name="41A">041A</a>	RET

; ----------------------------------------

<a href="#41B" name="41B">041B</a>	LD	A,(<a href="#Neznano6">Neznano6</a>)
<a href="#41E" name="41E">041E</a>	RLCA
<a href="#41F" name="41F">041F</a>	RLCA
<a href="#420" name="420">0420</a>	AND	#04
<a href="#422" name="422">0422</a>	PUSH	BC
<a href="#423" name="423">0423</a>	LD	B,A
<a href="#424" name="424">0424</a>	LD	A,(<a href="#Neznano1">Neznano1</a>)
<a href="#427" name="427">0427</a>	OR	B
<a href="#428" name="428">0428</a>	POP	BC
<a href="#429" name="429">0429</a>	RET

; ----------------------------------------

<a href="#42A" name="42A">042A</a>	CALL	<a href="#337">#0337</a>
<a href="#42D" name="42D">042D</a>	CALL	<a href="#41B">#041B</a>
<a href="#430" name="430">0430</a>	CALL	<a href="#337">#0337</a>
<a href="#433" name="433">0433</a>	LD	A,(<a href="#Neznano2">Neznano2</a>)
<a href="#436" name="436">0436</a>	CALL	<a href="#337">#0337</a>
<a href="#439" name="439">0439</a>	LD	A,(<a href="#Neznano6">Neznano6</a>)
<a href="#43C" name="43C">043C</a>	CALL	<a href="#337">#0337</a>
<a href="#43F" name="43F">043F</a>	LD	A,(<a href="#Neznano4">Neznano4</a>)
<a href="#442" name="442">0442</a>	CALL	<a href="#337">#0337</a>
<a href="#445" name="445">0445</a>	RET

; ----------------------------------------

<a href="#446" name="446">0446</a>	LD	A,#01
<a href="#448" name="448">0448</a>	CALL	<a href="#337">#0337</a>
<a href="#44B" name="44B">044B</a>	LD	A,(<a href="#Neznano4">Neznano4</a>)
<a href="#44E" name="44E">044E</a>	CALL	<a href="#337">#0337</a>
<a href="#451" name="451">0451</a>	LD	A,#0A
<a href="#453" name="453">0453</a>	CALL	<a href="#337">#0337</a>
<a href="#456" name="456">0456</a>	LD	A,#FF
<a href="#458" name="458">0458</a>	CALL	<a href="#337">#0337</a>
<a href="#45B" name="45B">045B</a>	RET

; ----------------------------------------

<a href="#45C" name="45C">045C</a>	LD	A,#79
<a href="#45E" name="45E">045E</a>	OUT	(#C0),A
<a href="#460" name="460">0460</a>	LD	HL,(<a href="#Neznano3">Neznano3</a>)
<a href="#463" name="463">0463</a>	LD	A,L
<a href="#464" name="464">0464</a>	OUT	(#C0),A
<a href="#466" name="466">0466</a>	LD	A,H
<a href="#467" name="467">0467</a>	OUT	(#C0),A
<a href="#469" name="469">0469</a>	LD	B,#0B
<a href="#46B" name="46B">046B</a>	LD	C,#C0
<a href="#46D" name="46D">046D</a>	RET

; ----------------------------------------

; Init string za FDC???

<a href="#46E" name="46E">046E</a>	DB	$FF, $00, $14, $28, $85, $F1, $8A, $CF
<a href="#476" name="476">0476</a>	DB	$01, $CF, $87, $FF, $00, $14, $28, $85
<a href="#47E" name="47E">047E</a>	DB	$F1, $8A, $CF, $05, $CF, $87

; ----------------------------------------

;;<a href="#FDNaloziCPMLDR" name="FDNaloziCPMLDR">FDNaloziCPMLDR</a>:
<a href="#484" name="484">0484</a>	LD	A,#13
<a href="#486" name="486">0486</a>	LD	(<a href="#Neznano7">Neznano7</a>),A
<a href="#489" name="489">0489</a>	XOR	A
<a href="#48A" name="48A">048A</a>	LD	(<a href="#Neznano1">Neznano1</a>),A
<a href="#48D" name="48D">048D</a>	CALL	<a href="#351">#0351</a>
<a href="#490" name="490">0490</a>	LD	HL,#E000
<a href="#493" name="493">0493</a>	LD	(<a href="#Neznano3">Neznano3</a>),HL
<a href="#496" name="496">0496</a>	XOR	A
<a href="#497" name="497">0497</a>	INC	A
<a href="#498" name="498">0498</a>	LD	(<a href="#Neznano4">Neznano4</a>),A
<a href="#49B" name="49B">049B</a>	CALL	<a href="#371">#0371</a>
<a href="#49E" name="49E">049E</a>	JP	NZ,<a href="#6D1">#06D1</a>
<a href="#4A1" name="4A1">04A1</a>	LD	DE,#0100
<a href="#4A4" name="4A4">04A4</a>	LD	HL,(<a href="#Neznano3">Neznano3</a>)
<a href="#4A7" name="4A7">04A7</a>	ADD	HL,DE
<a href="#4A8" name="4A8">04A8</a>	LD	(<a href="#Neznano3">Neznano3</a>),HL
<a href="#4AB" name="4AB">04AB</a>	LD	A,(<a href="#Neznano4">Neznano4</a>)
<a href="#4AE" name="4AE">04AE</a>	INC	A
<a href="#4AF" name="4AF">04AF</a>	LD	(<a href="#Neznano4">Neznano4</a>),A
<a href="#4B2" name="4B2">04B2</a>	LD	HL,#FFD8
<a href="#4B5" name="4B5">04B5</a>	CP	(HL)
<a href="#4B6" name="4B6">04B6</a>	JP	NZ,<a href="#49B">#049B</a>
<a href="#4B9" name="4B9">04B9</a>	LD	A,(<a href="#Neznano6">Neznano6</a>)
<a href="#4BC" name="4BC">04BC</a>	OR	A
<a href="#4BD" name="4BD">04BD</a>	RET	NZ
<a href="#4BE" name="4BE">04BE</a>	INC	A
<a href="#4BF" name="4BF">04BF</a>	LD	(<a href="#Neznano6">Neznano6</a>),A
<a href="#4C2" name="4C2">04C2</a>	LD	A,#0E
<a href="#4C4" name="4C4">04C4</a>	LD	(<a href="#Neznano7">Neznano7</a>),A
<a href="#4C7" name="4C7">04C7</a>	JP	<a href="#496">#0496</a>

; ----------------------------------------

;;<a href="#FDCIntHandler" name="FDCIntHandler">FDCIntHandler</a>:
<a href="#4CA" name="4CA">04CA</a>	EI
<a href="#4CB" name="4CB">04CB</a>	SCF
<a href="#4CC" name="4CC">04CC</a>	RETI

; ----------------------------------------

; Sem skocxi procedura na 02F1, ki ni nikoli klicana, torej tudi
; to ni nikoli klicano.

<a href="#4CE" name="4CE">04CE</a>	CALL	<a href="#FDNaloziCPMLDR">FDNaloziCPMLDR</a>
<a href="#4D1" name="4D1">04D1</a>	JP	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

;;<a href="#FDBoot" name="FDBoot">FDBoot</a>:
<a href="#4D4" name="4D4">04D4</a>	CALL	<a href="#FDNaloziCPMLDR">FDNaloziCPMLDR</a>
<a href="#4D7" name="4D7">04D7</a>	LD	A,(<a href="#CPMLDR">CPMLDR</a>)	; Prvi bajt prvega sektorja...
<a href="#4DA" name="4DA">04DA</a>	CP	#C3	; ... mora biti opcode za brezpogojni JP...
<a href="#4DC" name="4DC">04DC</a>	JP	Z,<a href="#4EA">#04EA</a>
<a href="#4DF" name="4DF">04DF</a>	CP	#31	; ... ali LD SP, nn
<a href="#4E1" name="4E1">04E1</a>	JP	Z,<a href="#4EA">#04EA</a>
<a href="#4E4" name="4E4">04E4</a>	LD	HL,#0593
<a href="#4E7" name="4E7">04E7</a>	JP	<a href="#Napaka">Napaka</a>

; Nalagalnik OSa je nalozxen; skocximo vanj
<a href="#4EA" name="4EA">04EA</a>	JP	<a href="#Trampolin">Trampolin</a>

; ----------------------------------------

<a href="#4ED" name="4ED">04ED</a>	IN	A,(#98)
<a href="#4EF" name="4EF">04EF</a>	AND	#01
<a href="#4F1" name="4F1">04F1</a>	RET

; ----------------------------------------

<a href="#4F2" name="4F2">04F2</a>	LD	A,#FF
<a href="#4F4" name="4F4">04F4</a>	PUSH	BC
<a href="#4F5" name="4F5">04F5</a>	LD	B,#FF
<a href="#4F7" name="4F7">04F7</a>	DEC	B
<a href="#4F8" name="4F8">04F8</a>	JP	NZ,<a href="#4F7">#04F7</a>
<a href="#4FB" name="4FB">04FB</a>	DEC	A
<a href="#4FC" name="4FC">04FC</a>	JP	NZ,<a href="#4F5">#04F5</a>
<a href="#4FF" name="4FF">04FF</a>	POP	BC
<a href="#500" name="500">0500</a>	RET

; ----------------------------------------

<a href="#501" name="501">0501</a>	CALL	<a href="#4ED">#04ED</a>
<a href="#504" name="504">0504</a>	JP	NZ,<a href="#50C">#050C</a>
<a href="#507" name="507">0507</a>	OUT	(#98),A
<a href="#509" name="509">0509</a>	CALL	<a href="#4F2">#04F2</a>
<a href="#50C" name="50C">050C</a>	XOR	A
<a href="#50D" name="50D">050D</a>	OUT	(#98),A
<a href="#50F" name="50F">050F</a>	LD	A,#47
<a href="#511" name="511">0511</a>	OUT	(#C8),A
<a href="#513" name="513">0513</a>	OUT	(#C9),A
<a href="#515" name="515">0515</a>	LD	A,#82
<a href="#517" name="517">0517</a>	OUT	(#C8),A
<a href="#519" name="519">0519</a>	OUT	(#C9),A
<a href="#51B" name="51B">051B</a>	LD	A,#A7
<a href="#51D" name="51D">051D</a>	OUT	(#CA),A
<a href="#51F" name="51F">051F</a>	LD	A,#FF
<a href="#521" name="521">0521</a>	OUT	(#CA),A
<a href="#523" name="523">0523</a>	RET

; ----------------------------------------

;;<a href="#NeznanIntHandler" name="NeznanIntHandler">NeznanIntHandler</a>:
<a href="#524" name="524">0524</a>	EI
<a href="#525" name="525">0525</a>	SCF
<a href="#526" name="526">0526</a>	CCF
<a href="#527" name="527">0527</a>	RETI

; ----------------------------------------

; Sporocxilo, da disketni pogon ni pripravljen.

<a href="#529" name="529">0529</a>	DB	$21, $00
<a href="#52B" name="52B">052B</a>	DZ	"FLOPPY DISK NOT READY !!!!"

; ----------------------------------------

;;<a href="#HDBoot" name="HDBoot">HDBoot</a>:
<a href="#546" name="546">0546</a>	CALL	<a href="#HDNaloziCPMLDR">HDNaloziCPMLDR</a>
<a href="#549" name="549">0549</a>	LD	A,(<a href="#CPMLDR">CPMLDR</a>)	; Prvi bajt prvega sektorja...
<a href="#54C" name="54C">054C</a>	CP	#31	; ... mora biti opcode za LD SP, nn
<a href="#54E" name="54E">054E</a>	JP	Z,<a href="#557">#0557</a>
<a href="#551" name="551">0551</a>	LD	HL,#0593
<a href="#554" name="554">0554</a>	JP	<a href="#Napaka">Napaka</a>

; Kopiramo ROM na 2000h
<a href="#557" name="557">0557</a>	LD	HL,#0000
<a href="#55A" name="55A">055A</a>	LD	DE,#2000
<a href="#55D" name="55D">055D</a>	LD	BC,#0800
<a href="#560" name="560">0560</a>	LDIR

; Kopiramo interrupt handler(?)
<a href="#562" name="562">0562</a>	LD	HL,#0761
<a href="#565" name="565">0565</a>	LD	DE,#C000
<a href="#568" name="568">0568</a>	LD	BC,#006C
<a href="#56B" name="56B">056B</a>	LDIR

<a href="#56D" name="56D">056D</a>	DI
<a href="#56E" name="56E">056E</a>	LD	A,#03
<a href="#570" name="570">0570</a>	OUT	(#C8),A
<a href="#572" name="572">0572</a>	OUT	(#C9),A
<a href="#574" name="574">0574</a>	LD	HL,#C000
<a href="#577" name="577">0577</a>	LD	A,H
<a href="#578" name="578">0578</a>	LD	I,A
<a href="#57A" name="57A">057A</a>	LD	A,L
<a href="#57B" name="57B">057B</a>	OUT	(#E8),A
<a href="#57D" name="57D">057D</a>	OUT	(#C8),A
<a href="#57F" name="57F">057F</a>	LD	A,#47
<a href="#581" name="581">0581</a>	OUT	(#C8),A
<a href="#583" name="583">0583</a>	LD	A,#FF
<a href="#585" name="585">0585</a>	OUT	(#C8),A
<a href="#587" name="587">0587</a>	LD	A,#C7
<a href="#589" name="589">0589</a>	OUT	(#C9),A
<a href="#58B" name="58B">058B</a>	LD	A,#64
<a href="#58D" name="58D">058D</a>	OUT	(#C9),A
<a href="#58F" name="58F">058F</a>	EI

; Nalagalnik OSa je nalozxen; skocximo vanj
<a href="#590" name="590">0590</a>	JP	<a href="#Trampolin">Trampolin</a>

; ----------------------------------------

; Sporocxilo, da trdi disk ni zagonski.

<a href="#593" name="593">0593</a>	DB	$21, $00
<a href="#595" name="595">0595</a>	DZ	"NO SYSTEM ON DISK"

; ----------------------------------------

; Sem skocxi procedura na 02F7, ki ni nikoli klicana, torej tudi
; to ni nikoli klicano.

<a href="#5A7" name="5A7">05A7</a>	CALL	<a href="#HDNaloziCPMLDR">HDNaloziCPMLDR</a>
<a href="#5AA" name="5AA">05AA</a>	JP	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

<a href="#5AD" name="5AD">05AD</a>	XOR	A
<a href="#5AE" name="5AE">05AE</a>	OUT	(#12),A
<a href="#5B0" name="5B0">05B0</a>	DI
<a href="#5B1" name="5B1">05B1</a>	LD	A,#47
<a href="#5B3" name="5B3">05B3</a>	OUT	(#C8),A
<a href="#5B5" name="5B5">05B5</a>	LD	A,#FF
<a href="#5B7" name="5B7">05B7</a>	OUT	(#C8),A
<a href="#5B9" name="5B9">05B9</a>	LD	A,#C7
<a href="#5BB" name="5BB">05BB</a>	OUT	(#C9),A
<a href="#5BD" name="5BD">05BD</a>	LD	A,#50
<a href="#5BF" name="5BF">05BF</a>	OUT	(#C9),A
<a href="#5C1" name="5C1">05C1</a>	EI
<a href="#5C2" name="5C2">05C2</a>	CALL	<a href="#5FC">#05FC</a>
<a href="#5C5" name="5C5">05C5</a>	LD	HL,#0755
<a href="#5C8" name="5C8">05C8</a>	CALL	<a href="#63D">#063D</a>
<a href="#5CB" name="5CB">05CB</a>	CALL	<a href="#662">#0662</a>
<a href="#5CE" name="5CE">05CE</a>	JP	NZ,<a href="#5C5">#05C5</a>
<a href="#5D1" name="5D1">05D1</a>	LD	A,#03
<a href="#5D3" name="5D3">05D3</a>	OUT	(#C9),A
<a href="#5D5" name="5D5">05D5</a>	RET

; ----------------------------------------

;;<a href="#CTCIntHandler" name="CTCIntHandler">CTCIntHandler</a>:
<a href="#5D6" name="5D6">05D6</a>	LD	A,#03
<a href="#5D8" name="5D8">05D8</a>	OUT	(#C9),A
<a href="#5DA" name="5DA">05DA</a>	CALL	<a href="#IzvediRETI">IzvediRETI</a>
<a href="#5DD" name="5DD">05DD</a>	EI
<a href="#5DE" name="5DE">05DE</a>	LD	HL,#05E6
<a href="#5E1" name="5E1">05E1</a>	JP	<a href="#Napaka">Napaka</a>

; ----------------------------------------

;;<a href="#IzvediRETI" name="IzvediRETI">IzvediRETI</a>:
<a href="#5E4" name="5E4">05E4</a>	RETI

; ----------------------------------------

; Sporocxilo, da trdi disk ni pripravljen.

<a href="#5E6" name="5E6">05E6</a>	DB	$21, $00
<a href="#5E8" name="5E8">05E8</a>	DZ	"HARD DISK NOT READY"

; ----------------------------------------

<a href="#5FC" name="5FC">05FC</a>	LD	HL,#0747
<a href="#5FF" name="5FF">05FF</a>	CALL	<a href="#652">#0652</a>
<a href="#602" name="602">0602</a>	CALL	<a href="#662">#0662</a>
<a href="#605" name="605">0605</a>	RET	Z
<a href="#606" name="606">0606</a>	LD	A,#34
<a href="#608" name="608">0608</a>	JP	<a href="#6D7">#06D7</a>

; ----------------------------------------

;;<a href="#HDNaloziCPMLDR" name="HDNaloziCPMLDR">HDNaloziCPMLDR</a>:
<a href="#60B" name="60B">060B</a>	CALL	<a href="#5AD">#05AD</a>
<a href="#60E" name="60E">060E</a>	LD	A,#C3
<a href="#610" name="610">0610</a>	OUT	(#C0),A
<a href="#612" name="612">0612</a>	LD	HL,#075B
<a href="#615" name="615">0615</a>	CALL	<a href="#63D">#063D</a>
<a href="#618" name="618">0618</a>	IN	A,(#10)
<a href="#61A" name="61A">061A</a>	AND	#40
<a href="#61C" name="61C">061C</a>	JP	Z,<a href="#618">#0618</a>
<a href="#61F" name="61F">061F</a>	IN	A,(#10)
<a href="#621" name="621">0621</a>	AND	#10
<a href="#623" name="623">0623</a>	JP	NZ,<a href="#634">#0634</a>
<a href="#626" name="626">0626</a>	LD	A,#22
<a href="#628" name="628">0628</a>	OUT	(#10),A
<a href="#62A" name="62A">062A</a>	CALL	<a href="#6A9">#06A9</a>
<a href="#62D" name="62D">062D</a>	IN	A,(#10)
<a href="#62F" name="62F">062F</a>	AND	#10
<a href="#631" name="631">0631</a>	JP	Z,<a href="#62D">#062D</a>
<a href="#634" name="634">0634</a>	CALL	<a href="#662">#0662</a>
<a href="#637" name="637">0637</a>	RET	Z
<a href="#638" name="638">0638</a>	LD	A,#32
<a href="#63A" name="63A">063A</a>	JP	<a href="#6D7">#06D7</a>

; ----------------------------------------

<a href="#63D" name="63D">063D</a>	CALL	<a href="#67F">#067F</a>
<a href="#640" name="640">0640</a>	CALL	<a href="#69B">#069B</a>
<a href="#643" name="643">0643</a>	LD	B,A
<a href="#644" name="644">0644</a>	AND	#10
<a href="#646" name="646">0646</a>	RET	Z
<a href="#647" name="647">0647</a>	LD	A,B
<a href="#648" name="648">0648</a>	AND	#40
<a href="#64A" name="64A">064A</a>	RET	NZ
<a href="#64B" name="64B">064B</a>	LD	A,(HL)
<a href="#64C" name="64C">064C</a>	OUT	(#11),A
<a href="#64E" name="64E">064E</a>	INC	HL
<a href="#64F" name="64F">064F</a>	JP	<a href="#640">#0640</a>

; ----------------------------------------

<a href="#652" name="652">0652</a>	CALL	<a href="#67F">#067F</a>
<a href="#655" name="655">0655</a>	CALL	<a href="#69B">#069B</a>
<a href="#658" name="658">0658</a>	AND	#40
<a href="#65A" name="65A">065A</a>	RET	NZ
<a href="#65B" name="65B">065B</a>	LD	A,(HL)
<a href="#65C" name="65C">065C</a>	OUT	(#11),A
<a href="#65E" name="65E">065E</a>	INC	HL
<a href="#65F" name="65F">065F</a>	JP	<a href="#655">#0655</a>

; ----------------------------------------

<a href="#662" name="662">0662</a>	CALL	<a href="#69B">#069B</a>
<a href="#665" name="665">0665</a>	AND	#10
<a href="#667" name="667">0667</a>	JP	NZ,<a href="#66F">#066F</a>
<a href="#66A" name="66A">066A</a>	LD	A,#42
<a href="#66C" name="66C">066C</a>	JP	<a href="#6D7">#06D7</a>
<a href="#66F" name="66F">066F</a>	IN	A,(#11)
<a href="#671" name="671">0671</a>	LD	B,A
<a href="#672" name="672">0672</a>	INC	HL
<a href="#673" name="673">0673</a>	CALL	<a href="#69B">#069B</a>
<a href="#676" name="676">0676</a>	IN	A,(#11)
<a href="#678" name="678">0678</a>	XOR	A
<a href="#679" name="679">0679</a>	OUT	(#10),A
<a href="#67B" name="67B">067B</a>	LD	A,B
<a href="#67C" name="67C">067C</a>	AND	#03
<a href="#67E" name="67E">067E</a>	RET

; ----------------------------------------

<a href="#67F" name="67F">067F</a>	IN	A,(#10)
<a href="#681" name="681">0681</a>	AND	#08
<a href="#683" name="683">0683</a>	JP	Z,<a href="#68B">#068B</a>
<a href="#686" name="686">0686</a>	LD	A,#41
<a href="#688" name="688">0688</a>	JP	<a href="#6D7">#06D7</a>
<a href="#68B" name="68B">068B</a>	LD	A,#01
<a href="#68D" name="68D">068D</a>	OUT	(#10),A
<a href="#68F" name="68F">068F</a>	IN	A,(#10)
<a href="#691" name="691">0691</a>	AND	#08
<a href="#693" name="693">0693</a>	JP	Z,<a href="#68F">#068F</a>
<a href="#696" name="696">0696</a>	LD	A,#02
<a href="#698" name="698">0698</a>	OUT	(#10),A
<a href="#69A" name="69A">069A</a>	RET

; ----------------------------------------

<a href="#69B" name="69B">069B</a>	IN	A,(#10)
<a href="#69D" name="69D">069D</a>	RLA
<a href="#69E" name="69E">069E</a>	JP	NC,<a href="#69B">#069B</a>
<a href="#6A1" name="6A1">06A1</a>	RRA
<a href="#6A2" name="6A2">06A2</a>	RET

; ----------------------------------------

<a href="#6A3" name="6A3">06A3</a>	LD	HL,#06C2
<a href="#6A6" name="6A6">06A6</a>	JP	<a href="#6AC">#06AC</a>

; ----------------------------------------

<a href="#6A9" name="6A9">06A9</a>	LD	HL,#06B3
<a href="#6AC" name="6AC">06AC</a>	LD	C,#C0
<a href="#6AE" name="6AE">06AE</a>	LD	B,#0F
<a href="#6B0" name="6B0">06B0</a>	OTIR
<a href="#6B2" name="6B2">06B2</a>	RET

; ----------------------------------------

; ??? init string za DMA

<a href="#6B3" name="6B3">06B3</a>	DB	$79, $00, $E0, $FF, $1E, $14, $28, $95
<a href="#6BB" name="6BB">06BB</a>	DB	$11, $00, $8A, $CF, $01, $CF, $87

; ----------------------------------------

; ??? init string za DMA

<a href="#6C2" name="6C2">06C2</a>	DB	$79, $00, $E0, $FF, $1E, $14, $28, $95
<a href="#6CA" name="6CA">06CA</a>	DB	$11, $00, $8A, $CF, $05, $CF, $87

; ----------------------------------------

<a href="#6D1" name="6D1">06D1</a>	LD	HL,#06E0
<a href="#6D4" name="6D4">06D4</a>	JP	<a href="#Napaka">Napaka</a>
<a href="#6D7" name="6D7">06D7</a>	LD	HL,#0714
;;<a href="#Napaka" name="Napaka">Napaka</a>:
<a href="#6DA" name="6DA">06DA</a>	CALL	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>
<a href="#6DD" name="6DD">06DD</a>	JP	<a href="#UkaznaVrstica">UkaznaVrstica</a>

; ----------------------------------------

; Sporocxilo, da je nekaj narobe z disketnim pogonom.

<a href="#6E0" name="6E0">06E0</a>	DB	$21, $00
<a href="#6E2" name="6E2">06E2</a>	DZ	"FLOPPY DISK MALFUNCTION !!!RETRY WITH COMMAND  F "

; ----------------------------------------

; Sporocxilo, da je nekaj narobe s trdim diskom.

<a href="#714" name="714">0714</a>	DB	$21, $00
<a href="#716" name="716">0716</a>	DZ	"HARD DISK MALFUNCTION &gt;&gt;&gt; RETRY WITH COMMAND  A "

; ----------------------------------------

; ???

<a href="#747" name="747">0747</a>	DB	$0C, $00, $00, $00, $00, $00, $01, $32
<a href="#74F" name="74F">074F</a>	DB	$04, $00, $80, $00, $40, $0B, $01, $00
<a href="#757" name="757">0757</a>	DB	$00, $00, $00, $00, $08, $00, $00, $00
<a href="#75F" name="75F">075F</a>	DB	$1F, $00

; ----------------------------------------

; IVT z 2 vnosoma za ???, ki kazxeta na rutino spodaj, ko je prekopirana.

<a href="#761" name="761">0761</a>	DW	<a href="#C004">$C004</a>, <a href="#C004">$C004</a>

; ----------------------------------------

; Rutina za ???, ki se prekopira na C000 skupaj z zgornjim IVT.

<a href="#765" name="765">0765</a>	DI
<a href="#766" name="766">0766</a>	LD	A,#03
<a href="#768" name="768">0768</a>	OUT	(#C8),A
<a href="#76A" name="76A">076A</a>	OUT	(#C9),A
<a href="#76C" name="76C">076C</a>	OUT	(#88),A
<a href="#76E" name="76E">076E</a>	LD	HL,#2000
<a href="#771" name="771">0771</a>	LD	DE,#0000
<a href="#774" name="774">0774</a>	LD	BC,#0800
<a href="#777" name="777">0777</a>	LDIR
<a href="#779" name="779">0779</a>	LD	HL,#02E8
<a href="#77C" name="77C">077C</a>	LD	A,L
<a href="#77D" name="77D">077D</a>	OUT	(#E8),A
<a href="#77F" name="77F">077F</a>	OUT	(#C8),A
<a href="#781" name="781">0781</a>	LD	A,H
<a href="#782" name="782">0782</a>	LD	I,A
<a href="#784" name="784">0784</a>	EI
<a href="#785" name="785">0785</a>	CALL	<a href="#IzvediRETI">IzvediRETI</a>
<a href="#788" name="788">0788</a>	LD	HL,#078E
<a href="#78B" name="78B">078B</a>	JP	<a href="#IzpisiPrelomInNiz">IzpisiPrelomInNiz</a>

; ----------------------------------------

; Sporocxilo o napaki pri nalaganju s trdega diska, ki se nikoli ne izpisxe?

<a href="#78E" name="78E">078E</a>	DB	$11, $00
<a href="#790" name="790">0790</a>	DZ	"LOADING ERROR FROM HARD DISK TRY TO LOAD SYSTEM FROM FLOPPY "

; ----------------------------------------

; Konec, nicx vecx zanimivega

<a href="#7CD" name="7CD">07CD</a>	DB	$FF
<a href="#7CE" name="7CE">07CE</a>	DS	50, $1A

; ----------------------------------------

;; F600: <a href="#Trampolin" name="Trampolin">Trampolin</a>
;; E000: <a href="#CPMLDR" name="CPMLDR">CPMLDR</a>
;; FFEB: <a href="#Scroll" name="Scroll">Scroll</a>
;; FFD0: <a href="#Neznano1" name="Neznano1">Neznano1</a>
;; FFD1: <a href="#Neznano2" name="Neznano2">Neznano2</a>
;; FFD2: <a href="#Neznano3" name="Neznano3">Neznano3</a>
;; FFD4: <a href="#Neznano4" name="Neznano4">Neznano4</a>
;; FFD5: <a href="#Neznano5" name="Neznano5">Neznano5</a>
;; FFD7: <a href="#Neznano6" name="Neznano6">Neznano6</a>
;; FFD8: <a href="#Neznano7" name="Neznano7">Neznano7</a>
</pre></body></html>